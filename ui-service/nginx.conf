server {
    # Escolta al port 80 (el que hem exposat a Docker)
    listen 80;
    server_name localhost;

    # 1. SERVIR L'APLICACIÓ REACT
    # ------------------------------------
    location / {
        # Ruta on hem copiat els arxius del 'build'
        root /usr/share/nginx/html;
        
        # Això és clau per a React Router:
        # Si no troba un arxiu (ex: /hotels), 
        # retorna /index.html perquè React gestioni la ruta.
        try_files $uri /index.html;
    }

    # 2. FER DE PROXY INVERS PER A L'API
    # ------------------------------------
    # Qualsevol petició que comenci amb /api...
    location /api {
        # ... la redirigim al contenidor del 'api-gateway'.
        # 'api-gateway' és el nom del servei al teu docker-compose.yml.
        proxy_pass http://api-gateway:8080;

        # Capçaleres necessàries
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }
}